<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="cn">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>编写 locustfile &#8212; lst 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="lst 0.0.1 documentation" href="index.html" />
    <link rel="next" title="Running Locust distributed" href="running-locust-distributed.html" />
    <link rel="prev" title="快速开始" href="quickstart.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="locustfile">
<h1>编写 locustfile<a class="headerlink" href="#locustfile" title="Permalink to this headline">¶</a></h1>
<p>locustfile 是一个普通的python文件。唯一必须的是它要定义至少一个类-然我们叫它locust类-这个类继承自Locust类。
A locustfile is a normal python file. The only requirement is that it declares at least one class—
let&#8217;s call it the locust class—that inherits from the class Locust.</p>
<div class="section" id="locust">
<h2>Locust 类<a class="headerlink" href="#locust" title="Permalink to this headline">¶</a></h2>
<p>一个locust类代表了一个用户(如果你愿意的话也可以是一个蝗虫)。Locust会为每一个模拟的用户产生(孵化)
出一个locust类的实例，一个locust类通常会定义几个属性。</p>
<div class="section" id="task-set">
<h3><code class="xref py py-attr docutils literal"><span class="pre">task_set</span></code> 属性<a class="headerlink" href="#task-set" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-attr docutils literal"><span class="pre">task_set</span></code> 属性需要指向一个
<code class="xref py py-class docutils literal"><span class="pre">TaskSet</span></code> 类，这个类定义了用户的行为，下面会有想象的描述。</p>
</div>
<div class="section" id="min-wait-max-wait">
<h3><em>min_wait</em> 和 <em>max_wait</em> 属性<a class="headerlink" href="#min-wait-max-wait" title="Permalink to this headline">¶</a></h3>
<p>除了task_set属性之外，通常还要定义*min_wait* 和 <em>max_wait</em> 属性。他们是一个模拟用户在执行每个任务之间
需要等待最小和最大时间，单位是毫秒。<em>min_wait</em> 和 <em>max_wait</em> 默认值为1000，因此每个蝗虫总是在每个任务
之间总是会等待1秒，如果*min_wait* and <em>max_wait</em> 没有定义的话。</p>
<p>根据如下的locustfile，每个用户在任务之间会等待5至15秒:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="k">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span>
    <span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;executing my_task&quot;</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
    <span class="n">min_wait</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">max_wait</span> <span class="o">=</span> <span class="mi">15000</span>
</pre></div>
</div>
<p><em>min_wait</em> 和 <em>max_wait</em> 属性都可以在TaskSet类中被覆盖。</p>
</div>
<div class="section" id="weight">
<h3><em>weight</em> 属性<a class="headerlink" href="#weight" title="Permalink to this headline">¶</a></h3>
<p>你可以在同一个文件中运行两个蝗虫，像这样:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">locust</span> <span class="o">-</span><span class="n">f</span> <span class="n">locust_file</span><span class="o">.</span><span class="n">py</span> <span class="n">WebUserLocust</span> <span class="n">MobileUserLocust</span>
</pre></div>
</div>
<p>如果你希望其中一个蝗虫执行更多次数，你可以在那些类里设置一个权重属性。比如说，网页用户可能是移动端用户的三倍:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WebUserLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="o">....</span>

<span class="k">class</span> <span class="nc">MobileUserLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">....</span>
</pre></div>
</div>
</div>
<div class="section" id="host">
<h3><em>host</em> 属性<a class="headerlink" href="#host" title="Permalink to this headline">¶</a></h3>
<p>host属性是需要被加载的主机的URL前缀(即 &#8220;<a class="reference external" href="http://google.com">http://google.com</a>&#8221;)。通常，这个在locust启动时在命令行指定，
使用 <code class="code docutils literal"><span class="pre">--host</span></code> 选项。如果在locust类中定义的host属性，当没有在命令行指定:code:<cite>&#8211;host</cite> 时就会使用。</p>
</div>
</div>
<div class="section" id="taskset">
<h2>TaskSet 类<a class="headerlink" href="#taskset" title="Permalink to this headline">¶</a></h2>
<p>如果Locust类代表了一个蝗虫，你可以说TaskSet类代表了蝗虫的大脑。每个Locust类必须有一个*task_set*属性集，
指向一个TaskSet。</p>
<p>一个TaskSet就是，就像它的名字所示的，一个任务的集合。这些任务是普通的可调用的python-如果我们是加载-测试一个
竞拍网站-可以做一些&#8221;加载开始页面&#8221;，&#8221;搜索某些商品&#8221;以及&#8221;出价&#8221;之类的事情。</p>
<p>当一个负载测试开始后，所产生的每一个Locust类将开始执行它们的TaskSet。接下来发生的就是每个TaskSet将要选择其中
一个任务并调用。然后会等待的好秒数是在Locust 类的 <em>min_wait</em> and <em>max_wait</em> 属性中选择的一个随机数
(除非min_wait/max_wait已经在TaskSet中直接定义了，这种情况下将使用它本身的值)。然后有会选择一个新的任务来调用，
然后又等待，如此往复。</p>
<div class="section" id="tasks">
<h3>声明 tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h3>
<p>典型的为一个TaskSet声明tasks使用:py:meth:<cite>task &lt;locust.core.task&gt;</cite> 装饰器。</p>
<p>这是一个例子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>   from locust import Locust, TaskSet, task

   class MyTaskSet(TaskSet):
       @task
       def my_task(self):
           print &quot;Locust instance (%r) executing my_task&quot; % (self.locust)

   class MyLocust(Locust):
       task_set = MyTaskSet

**@task** 需要一个可选的权重参数，可以用来指定任务的执行率。在下面的例子中 *task2* 执行次数将会是 *task1* 两倍::

   from locust import Locust, TaskSet, task

   class MyTaskSet(TaskSet):
       min_wait = 5000
       max_wait = 15000

       @task(3)
       def task1(self):
           pass

       @task(6)
       def task2(self):
           pass

   class MyLocust(Locust):
       task_set = MyTaskSet
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>tasks 属性<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>使用&#64;task装饰来定义tasks是一个方便的，通常也是最好的方式。然而，也可以通过设置 <code class="xref py py-attr docutils literal"><span class="pre">tasks</span></code>
属性来定义一个TaskSet的tasks(使用&#64;task装饰器会只填充*tasks*属性)。</p>
<p><em>tasks*属性既是一个python可调用的列表，也是一个*&lt;callable : int&gt;*字典。tasks是可调用的python，它接收一个参数-
The *tasks</em> attribute is either a list of python callables, or a <em>&lt;callable : int&gt;</em> dict.
The tasks are python callables that receive one argument—the TaskSet class instance that is executing
the task. Here is an extremely simple example of a locustfile (this locustfile won&#8217;t actually load test anything):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="k">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span>

<span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_task</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
</pre></div>
</div>
<p>If the
tasks attribute is specified as a list, each time a task is to be performed, it will be randomly
chosen from the <em>tasks</em> attribute. If however, <em>tasks</em> is a dict—with callables as keys and ints
as values—the task that is to be executed will be chosen at random but with the int as ratio. So
with a tasks that looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">my_task</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">another_task</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p><em>my_task</em> would be 3 times more likely to be executed than <em>another_task</em>.</p>
</div>
<div class="section" id="tasksets-can-be-nested">
<h3>TaskSets can be nested<a class="headerlink" href="#tasksets-can-be-nested" title="Permalink to this headline">¶</a></h3>
<p>A very important property of TaskSets is that they can be nested, because real websites are usually
built up in an hierarchical way, with multiple sub-sections. Nesting TaskSets will therefore allow
us to define a behaviour that simulates users in a more realistic way. For example
we could define TaskSets with the following structure:</p>
<ul class="simple">
<li>Main user behaviour</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Index page</li>
<li>Forum page</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Read thread</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Reply</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>New thread</li>
<li>View next page</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Browse categories</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Watch movie</li>
<li>Filter movies</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>About page</li>
</ul>
</div></blockquote>
<p>The way you nest TaskSets is just like when you specify a task using the <strong>tasks</strong> attribute, but
instead of referring to a python function, you point it to another TaskSet:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ForumPage</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interrupt</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">UserBehaviour</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="n">ForumPage</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>

    <span class="nd">@task</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>So in above example, if the ForumPage would get selected for execution when the UserBehaviour
TaskSet is executing, then the ForumPage TaskSet would start executing. The ForumPage TaskSet
would then pick one of its own tasks, execute it, then wait, and so on.</p>
<p>There is one important thing to note about the above example, and that is the call to
self.interrupt() in the ForumPage&#8217;s stop method. What this does is essentially that it will
stop executing the ForumPage task set and the execution will continue in the UserBehaviour instance.
If we wouldn&#8217;t have had a call to the <code class="xref py py-meth docutils literal"><span class="pre">interrupt()</span></code> method
somewhere in ForumPage, the Locust would never stop running the ForumPage task once it has started.
But by having the interrupt function, we can—together with task weighting—define how likely it
is that a simulated user leaves the forum.</p>
<p>It&#8217;s also possible to declare a nested TaskSet, inline in a class, using the
<code class="xref py py-meth docutils literal"><span class="pre">&#64;task</span></code> decorator, just like when declaring normal tasks:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span>
    <span class="k">class</span> <span class="nc">SubTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
        <span class="nd">@task</span>
        <span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="the-on-start-function">
<h3>The on_start function<a class="headerlink" href="#the-on-start-function" title="Permalink to this headline">¶</a></h3>
<p>A TaskSet class can optionally declare an <code class="xref py py-meth docutils literal"><span class="pre">on_start</span></code> function.
If so, that function is called when a simulated user starts executing that TaskSet class.</p>
</div>
<div class="section" id="referencing-the-locust-instance-or-the-parent-taskset-instance">
<h3>Referencing the Locust instance, or the parent TaskSet instance<a class="headerlink" href="#referencing-the-locust-instance-or-the-parent-taskset-instance" title="Permalink to this headline">¶</a></h3>
<p>A TaskSet instance will have the attribute <code class="xref py py-attr docutils literal"><span class="pre">locust</span></code> point to
its Locust instance, and the attribute <code class="xref py py-attr docutils literal"><span class="pre">parent</span></code> point to its
parent TaskSet (it will point to the Locust instance, in the base TaskSet).</p>
</div>
</div>
<div class="section" id="making-http-requests">
<h2>Making HTTP requests<a class="headerlink" href="#making-http-requests" title="Permalink to this headline">¶</a></h2>
<p>So far, we&#8217;ve only covered the task scheduling part of a Locust user. In order to actually load test
a system we need to make HTTP requests. To help us do this, the <code class="xref py py-class docutils literal"><span class="pre">HttpLocust</span></code>
class exists. When using this class, each instance gets a
<code class="xref py py-attr docutils literal"><span class="pre">client</span></code> attribute which will be an instance of
<code class="xref py py-attr docutils literal"><span class="pre">HttpSession</span></code> which can be used to make HTTP requests.</p>
<p>When inheriting from the HttpLocust class, we can use its client attribute to make HTTP requests
against the server. Here is an example of a locust file that can be used to load test a site
with two URLs; <strong>/</strong> and <strong>/about/</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="k">import</span> <span class="n">HttpLocust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/about/&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">HttpLocust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
    <span class="n">min_wait</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">max_wait</span> <span class="o">=</span> <span class="mi">15000</span>
</pre></div>
</div>
<p>Using the above Locust class, each simulated user will wait between 5 and 15 seconds
between the requests, and <strong>/</strong> will be requested twice as much as <strong>/about/</strong>.</p>
<p>The attentive reader will find it odd that we can reference the HttpSession instance
using <em>self.client</em> inside the TaskSet, and not <em>self.locust.client</em>. We can do this
because the <code class="xref py py-class docutils literal"><span class="pre">TaskSet</span></code> class has a convenience property
called client that simply returns self.locust.client.</p>
</div>
<div class="section" id="using-the-http-client">
<h2>Using the HTTP client<a class="headerlink" href="#using-the-http-client" title="Permalink to this headline">¶</a></h2>
<p>Each instance of HttpLocust has an instance of <code class="xref py py-class docutils literal"><span class="pre">HttpSession</span></code>
in the <em>client</em> attribute. The HttpSession class is actually a subclass of
<code class="xref py py-class docutils literal"><span class="pre">requests.Session</span></code> and can be used to  make HTTP requests, that will be reported to Locust&#8217;s
statistics, using the <code class="xref py py-meth docutils literal"><span class="pre">get</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">post</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">put</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">delete</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">head</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">patch</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">options</span></code>
methods. The HttpSession instance will preserve cookies between requests so that it can be used to log in
to websites and keep a session between requests. The client attribute can also be reference from the Locust
instance&#8217;s TaskSet instances so that it&#8217;s easy to retrieve the client and make HTTP requests from within your
tasks.</p>
<p>Here&#8217;s a simple example that makes a GET request to the <em>/about</em> path (in this case we assume <em>self</em>
is an instance of a <code class="xref py py-class docutils literal"><span class="pre">TaskSet</span></code> or <code class="xref py py-class docutils literal"><span class="pre">HttpLocust</span></code>
class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/about&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Response status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="nb">print</span> <span class="s2">&quot;Response content:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</pre></div>
</div>
<p>And here&#8217;s an example making a POST request:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span><span class="s2">&quot;secret&quot;</span><span class="p">})</span>
</pre></div>
</div>
<div class="section" id="safe-mode">
<h3>Safe mode<a class="headerlink" href="#safe-mode" title="Permalink to this headline">¶</a></h3>
<p>The HTTP client is configured to run in safe_mode. What this does is that any request that fails due to
a connection error, timeout, or similar will not raise an exception, but rather return an empty dummy
Response object. The request will be reported as a failure in Locust&#8217;s statistics. The returned dummy
Response&#8217;s <em>content</em> attribute will be set to None, and its <em>status_code</em> will be 0.</p>
</div>
<div class="section" id="manually-controlling-if-a-request-should-be-considered-successful-or-a-failure">
<h3>Manually controlling if a request should be considered successful or a failure<a class="headerlink" href="#manually-controlling-if-a-request-should-be-considered-successful-or-a-failure" title="Permalink to this headline">¶</a></h3>
<p>By default, requests are marked as failed requests unless the HTTP response code is OK (2xx).
Most of the time, this default is what you want. Sometimes however—for example when testing
a URL endpoint that you expect to return 404, or testing a badly designed system that might
return <em>200 OK</em> even though an error occurred—there&#8217;s a need for manually controlling if
locust should consider a request as a success or a failure.</p>
<p>One can mark requests as failed, even when the response code is OK, by using the
<em>catch_response</em> argument and a with statement:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">catch_response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="o">!=</span> <span class="s2">&quot;Success&quot;</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="s2">&quot;Got wrong response&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Just as one can mark requests with OK response codes as failures, one can also use <strong>catch_response</strong>
argument together with a <em>with</em> statement to make requests that resulted in an HTTP error code still
be reported as a success in the statistics:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/does_not_exist/&quot;</span><span class="p">,</span> <span class="n">catch_response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-requests-to-urls-with-dynamic-parameters">
<h3>Grouping requests to URLs with dynamic parameters<a class="headerlink" href="#grouping-requests-to-urls-with-dynamic-parameters" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s very common for websites to have pages whose URLs contain some kind of dynamic parameter(s).
Often it makes sense to group these URLs together in Locust&#8217;s statistics. This can be done
by passing a <em>name</em> argument to the <code class="xref py py-class docutils literal"><span class="pre">HttpSession's</span></code>
different request methods.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Statistics for these requests will be grouped under: /blog/?id=[id]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/blog?id=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;/blog?id=[id]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">编写 locustfile</a><ul>
<li><a class="reference internal" href="#locust">Locust 类</a><ul>
<li><a class="reference internal" href="#task-set"><code class="docutils literal"><span class="pre">task_set</span></code> 属性</a></li>
<li><a class="reference internal" href="#min-wait-max-wait"><em>min_wait</em> 和 <em>max_wait</em> 属性</a></li>
<li><a class="reference internal" href="#weight"><em>weight</em> 属性</a></li>
<li><a class="reference internal" href="#host"><em>host</em> 属性</a></li>
</ul>
</li>
<li><a class="reference internal" href="#taskset">TaskSet 类</a><ul>
<li><a class="reference internal" href="#tasks">声明 tasks</a></li>
<li><a class="reference internal" href="#id1">tasks 属性</a></li>
<li><a class="reference internal" href="#tasksets-can-be-nested">TaskSets can be nested</a></li>
<li><a class="reference internal" href="#the-on-start-function">The on_start function</a></li>
<li><a class="reference internal" href="#referencing-the-locust-instance-or-the-parent-taskset-instance">Referencing the Locust instance, or the parent TaskSet instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#making-http-requests">Making HTTP requests</a></li>
<li><a class="reference internal" href="#using-the-http-client">Using the HTTP client</a><ul>
<li><a class="reference internal" href="#safe-mode">Safe mode</a></li>
<li><a class="reference internal" href="#manually-controlling-if-a-request-should-be-considered-successful-or-a-failure">Manually controlling if a request should be considered successful or a failure</a></li>
<li><a class="reference internal" href="#grouping-requests-to-urls-with-dynamic-parameters">Grouping requests to URLs with dynamic parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">快速开始</a></li>
      <li>Next: <a href="running-locust-distributed.html" title="next chapter">Running Locust distributed</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/writing-a-locustfile.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, gx.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/writing-a-locustfile.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>